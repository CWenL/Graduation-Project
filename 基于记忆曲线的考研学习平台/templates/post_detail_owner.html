<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/css/post.css">
  <link rel="stylesheet" href="/static/css/bootstrap.css">
  <title>å¸–å­è¯¦æƒ…</title>
  <script src="/static/js/jquery-3.7.1.min.js" ></script>
  <script src="/static/js/bootstrap.js"></script>
  <script src="/static/js/bootstrap.bundle.js"></script>
  <script src="/static/js/time.js"></script>
  <script src="/static/js/search.js"></script>
  <script src="/static/js/commonUser.js"></script>
</head>
<style>
    /* æ·»åŠ åª’ä½“æŸ¥è¯¢è¦†ç›–å®¹å™¨å®½åº¦ */
    @media (min-width: 1400px) {
      .container-xxl,
      .container-xl,
      .container-lg,
      .container-md,
      .container-sm,
      .container {
            max-width: 80%; /* è®¾ç½®ä½ éœ€è¦çš„å®½åº¦ */
        }
    }
  </style>
<body>
<div class="container">
  <div class="main-content">
<!-- æ¨¡æ€æ¡†ç»“æ„ -->
<div id="myModal" class="modal">
  <!-- æ¨¡æ€æ¡†çš„å†…å®¹ -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <img class="modal-image" id="modalImage">
  </div>
</div>
  <!-- å¯¼èˆªæ  -->
  <header>
    <!-- ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶ -->
    <div style="float: left;">
      <button class="back-btn" onclick="window.history.back();">è¿”å›ä¸Šä¸€çº§</button>
      <button class="back-btn" onclick="window.location.href='/userpage';">è¿”å›ä¸ªäººä¸»é¡µ</button>
      <!-- æ·»åŠ åˆ é™¤æŒ‰é’® -->
      <button class="delete-btn" data-question-id="{{ post[0] }}" onclick="deleteThisPost(this)">åˆ é™¤æœ¬å¸–</button>
      </div>
    <h1>å¸–å­è¯¦æƒ…</h1>
  </header>

  <!-- å¸–å­å†…å®¹ -->
  <section class="post-content">
    <h2 class="post-title">ä¸»é¢˜&nbsp;:&nbsp;{{ post[1] }}</h2><br>
    <!-- æ ‡ç­¾éƒ¨åˆ† -->
    <div class="tags" style="text-align: left;">
        {% set tags = post[5].split('#') %}
        {% for tag in tags %}
            {% if tag %}
                {% if loop.index == 2 %}
                    <span class="badge bg-danger">{{ tag }}</span>
                {% elif loop.index == 3 %}
                    <span class="badge bg-primary">{{ tag }}</span>
                {% elif loop.index == 4 %}
                    <span class="badge bg-info">{{ tag }}</span>
                {% else %}
                    <span class="badge bg-secondary">{{ tag }}</span>
                {% endif %}
            {% endif %}
          {% endfor %}
      </div>
    <div class="post-body">
        <!-- å›¾ç‰‡éƒ¨åˆ† -->
        {% if post[7]  %}
        <img src="{{ post[7] }}" style="width: 700px; height: auto;" alt="Post Image">
        {% endif %}
        <br>
        <p style="font-size: 25px;background-color: #fcfcfc;">æè¿°ï¼š&nbsp;{{ post[6] }}</p>
    </div><br>
    <div class="post-info">
        <span class="author"style="float: left;">ä½œè€…: {{ post[2] }}</span><br>
        <span class="author"style="float: left;">ipæ‰€å±åœ°: {{ post[4] }}</span>
        <span class="post-time" style="float: right;">å‘å¸ƒæ—¶é—´: {{ post[3] }}</span><br><hr>
        <p class="card-text"style="text-align: left;">
            <span style="float: right; font-size: large;"><i class="bi bi-eye "></i> {{post[9]}} view</span></p>
            <div class="d-flex justify-content-between">
              <button class="like-btn" data-id="{{ post[0] }}" data-liked="{{ 'true' if liked else 'false' }}">
                {% if liked %}
                  <span class="heart">â¤ï¸</span>
                {% else %}
                  <span class="heart">ğŸ¤</span>
                {% endif %}
                <span class="like-count">{{post[8]}}</span>
            </button>  
                    
              </div>
              
        </div>   
  </section>
  
  <!-- è¯„è®ºåŒº -->
  <section class="comments-section">
    <h3>è¯„è®ºåŒº</h3><hr><br>
    <!-- è¯„è®ºåˆ—è¡¨ -->
    <div class="comments-list">
        
      <div class="comment">
        <span class="comment-author">æå››</span>
        <p class="comment-body">è¿™ä¸ªå¸–å­è®²çš„çœŸå¥½ï¼Œæˆ‘å¾ˆèµåŒï¼</p>
        <span class="comment-time">2025-02-23 12:30</span>
      </div>
      {% for index, cdata in commentdata %}
      <div class="comment">
        <span class="comment-author">{{ cdata[2] }}</span><br>
        <img src="{{ cdata[5] }}" style="width: 700px; height: auto;" alt="">
        <p class="comment-body">{{ cdata[3] }}</p>
        <span class="comment-time">{{ cdata[4] }}</span><span class="comment-time"style="float: right;">ç¬¬{{ index+1 }}æ¥¼</span>
      </div>
      {% endfor %}
    </div>

    <!-- è¯„è®ºè¾“å…¥æ¡† -->
    <form action="{{ url_for('InputComment') }}" method="POST" enctype="multipart/form-data">
      <div class="comment-input">
        <textarea name="comment_text" placeholder="å‘è¡¨è¯„è®º..."></textarea><br>
        <!-- æ–‡ä»¶ä¸Šä¼ å­—æ®µ -->
        <input type="file" name="comment_image" accept="image/*">
        <!-- éšè—çš„å¸–å­ ID å­—æ®µ -->
        <input type="hidden" name="post_id" value="{{ post[0] }}">
        <button type="submit" class="submit-btn">å‘å¸ƒè¯„è®º</button>
      </div>
    </form>
  </section>
</div>
  <div class="edit-area">
    <h2 class="fw-bolder">ä¿®æ”¹å¸–å­ä¿¡æ¯</h2>
    <form action="/update_post" method="post" enctype="multipart/form-data">
      <input type="hidden" name="post_id" value="{{ post[0] }}">
      <div class="form-group">
        <label>å¸–å­æ ‡é¢˜</label>
        <input type="text" id="post_tittle" name="post_tittle" value="{{ post[1] }}">
    </div>
    <div class="form-group">
        <label>å¸–å­å†…å®¹</label>
        <textarea id="post_body" name="post_body" rows="5">{{ post[6] }}</textarea>
    </div>
    <div class="form-group">
      <label>å›¾ç‰‡</label>
      <input class="file_input" type="file" name="post_image" value="{{ post[7] }}">
    </div>
    <div class="form-group">
        <label>é¢˜ç›®æ ‡ç­¾(æ ¼å¼ï¼š#æ ‡ç­¾1#æ ‡ç­¾2...)</label>
        <input type="text" id="post_tag" name="post_tag" value="{{ post[5] }}">
        <span id="error_message" style="color: red;"></span>
    </div>
    <button type="submit" class="btn btn-primary" onclick="return validateForm() && validateLabel()">ä¿å­˜ä¿®æ”¹</button>
    </form>
  </div>
</div>
</div>
<div class="time-container">
  <div id="time"></div>
</div>
<br><br><br><br><br><br>
<div class="time-container2">
  <div id="countdown">00å¤© 00å°æ—¶ 00åˆ†é’Ÿ 00ç§’</div>
</div>
</div>
  <script src="/static/js/modal.js"></script>   
  <script src="/static/js/like.js"></script>   
  <script>
    function validateLabel() {
    let inputField = document.getElementById("post_tag");
    let errorMessage = document.getElementById("error_message");
    let regex = /^(#[\u4e00-\u9fa5\w]+)+$/;  // å…è®¸ä¸­æ–‡ã€å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
    if (!regex.test(inputField.value.trim())) {
        errorMessage.innerText = "æ ¼å¼é”™è¯¯ï¼è¯·è¾“å…¥ç±»ä¼¼ #æ ‡ç­¾1#æ ‡ç­¾2 çš„æ ¼å¼";
        return false;
    }
    errorMessage.innerText = ""; // æ¸…é™¤é”™è¯¯ä¿¡æ¯
    return true;
}
    </script>
    <!-- åˆ¤æ–­å¿…å¡«é¡¹æ˜¯å¦ä¸ºç©º -->
  <script>
    function validateForm() {
    // è·å–è¡¨å•å­—æ®µ
    var textContent = document.getElementById('post_body').value.trim();
    var postTittle = document.getElementById('post_tittle').value.trim();
    var postTag = document.getElementById('post_tag').value.trim();
    // æ£€æŸ¥å¸–å­æ ‡é¢˜æ˜¯å¦ä¸ºç©º
    if (postTittle === "") {
        alert("è¯·å¡«å†™æ ‡é¢˜ï¼");
        return false;
    }
    // æ£€æŸ¥å¸–å­å†…å®¹æ˜¯å¦ä¸ºç©º
    if (textContent === "") {
        alert("è¯·å¡«å†™å†…å®¹ï¼");
        return false;
    }
    // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦ä¸ºç©º
    if (postTag === "" || postTag === "#") {
        alert("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼");
        return false;
    }
    return true;
}
</script>
</body>
</html>
